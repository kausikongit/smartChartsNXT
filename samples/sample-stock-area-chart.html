<html>

<head>
  <script src="/smartChartsNXT/public/smartChartsNXT.bundle.js" type="text/javascript"></script>
  <script>
    async function getStock(stockId) {
      var data = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${stockId}&interval=5min&apikey=NSQWJINYQ9CB6GR3`); 
      return data.json(); 
    }

    window.onload = function () {
      //^BSESN, RCOM.NS, GRAPHITE.NS
      getStock('RCOM.NS').then(data => {
        console.log(data);
        var dataSet = prepareData(data);
        displayChart('RCom', dataSet); 
      });
    };

    function prepareData(data) {
      var dataSet = [];
      for(key in data['Time Series (Daily)']){
        dataSet.push({
          label: key,
          value: data['Time Series (Daily)'][key]['4. close']
        });
      }
      return dataSet; 
    }


    function displayChart(seriesName, dataSet) {
      SmartChartsNXT.ready(function () {
        let areaChart = new SmartChartsNXT.Chart({
          "type": "AreaChart",
          "title": "Multi Series Chart",
          "subtitle": "Area Chart",
          "targetElem": "chartContainer",
          "titleStyle": {
            "fillColor":"#717171",
            "borderColor":"none",
            "fontFamily": "Lato",
            "maxFontSize": "25"
          },
          "subtitleStyle": {
            "fillColor":"#717171",
            "borderColor":"none",
            "fontFamily": "Lato",
            "maxFontSize": "18"
          },
          "canvasBorder": true,
          "bgColor": "none",
          "pointerCrosshair": {
            "vertical": {
              "style": "dashed",  // [dashed | solid]
              "spread" : "full",  // [full | inPoint | none]
              "color": "#000",
              "lineWidth": 1,
              "opacity": 1
            },
            "horizontal": {
              "style": "dashed",  
              "spread" : "none",
              "color": "#000",
              "lineWidth": 1,
              "opacity": 1
            }
          },
          "legends":{
            "enable" : true,
            "alignment": "horizontal",
            "color": "#000",
            "bgColor": "none",
            "opacity": 0.9,
            "toggleType": true,
          },
          "tooltip": {
            "content": function() {
              return '<table>' +
                '<tbody>' +
                  '<tr style="background-color: #aaa; font-size: 14px; text-align: left; color: #FFF;">' +
                    '<th colspan="2" style="padding: 2px 5px; ">' + this[0].formattedLabel + '</th>' +
                  '</tr>' +
                    this.map(function(point) {
                      return '<tr>' + 
                          '<td style="font-size: 13px; padding: 3px 6px; background-color: #fff;">' +
                            '<span style="background-color:' + point.seriesColor +'; display:inline-block; width:10px; height:10px;margin-right:5px;"></span>' + point.seriesName + '</td>' +
                          '<td style="font-size: 13px; padding: 3px 6px; background-color: #fff;">'+ point.value + '</td>' +
                        '</tr>';
                    }).join('') +
                '</tbody>' +
              '</table>';
            },
            "xPadding": 3,
            "yPadding": 3,
          },
          "dataSet": {
            "xAxis": {
              "title": "Date",
              "prefix": "",
              "parseAsDate": true,
              "dateFormat": "dd mmm",
              "labelRotate": -45,
              "intervalThreshold": 40,
              "tickOpacity": 1,
              "tickColor": '#222',
              "tickSpan": 6,
              "labelOpacity": 1,
              //"labelColor": "#009688",
              "fontSize": 14,
              "fontFamily": "Lato"
            },
            "yAxis": {
              "title": "Total Sales",
              "prefix": "Rs. ",
              "labelRotate": 0,
              "tickOpacity": 1,
              "tickColor": '#222',
              "tickSpan": 5,
              "labelOpacity": 1,
              //"labelColor": "#009688",
              "fontSize": 20,
              "fontFamily": "Lato"
            },
            "series": [{
                "lineWidth": 1.5,
                "bgColor": "#2278b4",
                "name": seriesName,
                "areaOpacity": 0.3,
                "spline": true,
                "data": dataSet //generateData(10, 50, 100) 
              }
              // ,{
              //   "lineWidth": 1.5,
              //   "bgColor": "#ff7f0e",
              //   "marker": true,
              //   "markerRadius": 3,
              //   "spline": false,
              //   "gradient": true,
              //   "areaOpacity": 0.5,
              //   "lineOpacity": 1,
              //   "name": 'Willson',
              //   "data": //generateData(5, 20, 10)
              //   [
              //     {label:1, value:25},{label:2, value:79},{label:3, value:-19},{label:4, value:0},{label:5, value:1220}
              //     //{label:1, value:0},{label:2, value:1}
              //   ] 
              // }
            ]
          },
          zoomWindow: {
            "leftIndex": 1,
            "rightIndex": dataSet.length
          }
        });
      });
    }
  </script>
</head>

<body style='overflow:hidden;'>
  <div>
    <div id='chartContainer' style="width:100%; height:100%;">
    </div>
  </div>
</body>

</html>